{% extends 'admin/homeadmin.html.twig' %}

{% block title %}Gestion des vols{% endblock %}

{% block Content %}
<style>
    .vol-ticket {
        border: 2px solid;
        border-radius: 8px;
        background-color: #fff;
        box-shadow: 0 2px 20px 2px rgba(39, 39, 62, .1);
        transition: all 0.3s ease;
        margin-bottom: 20px;
    }

    .vol-ticket:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 25px rgba(0,0,0,0.15);
    }

    .vol-local {
        border-color: #7c4dff;
    }

    .vol-api {
        border-color: #17a2b8;
    }

    .vol-header {
        padding: 15px 20px;
        border-radius: 6px 6px 0 0;
    }

    .vol-local .vol-header {
        background: linear-gradient(45deg, #f8f5ff, #ffffff);
    }

    .vol-api .vol-header {
        background: linear-gradient(45deg, #f0faff, #ffffff);
    }

    .vol-body {
        padding: 20px;
    }

    .divider {
        border-top: 2px solid #f0f0f0;
        margin: 15px 0;
    }

    .badge-flight {
        font-size: 0.9em;
        padding: 8px 12px;
        border-radius: 20px;
    }

    .btn-outline-secondary:disabled, 
    .btn-outline-danger:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
</style>

<div class="content-wrapper">
    <div class="page-header">
        <h3 class="page-title">
            <span class="page-title-icon bg-gradient-primary text-white me-2">
                <i class="mdi mdi-airplane"></i>
            </span> 
            Gestion des vols
        </h3>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">

                    <div class="text-end mb-4">
                        <a href="{{ path('vol_new') }}" class="btn btn-gradient-primary btn-rounded">
                            <i class="mdi mdi-plus-circle-outline me-2"></i> Nouveau vol
                        </a>
                    </div>

                   <div class="d-flex justify-content-between align-items-center mb-4">
    <a href="{{ path('admin_listreservations') }}" class="btn btn-outline-primary">
        <i class="mdi mdi-account-multiple-outline me-1"></i> Les réservations
    </a>
    <h4 class="text-primary mb-0 text-center flex-grow-1" style="margin-left: -40px;">Liste des vols :</h4>
    <div style="width: 150px;"></div> <!-- Espace vide pour équilibrer -->
</div>

                    {% if vols is not empty %}
                        <div class="row">
                            {% for vol in vols %}
                                <div class="col-md-6 mb-4 vol-item {% if loop.index > 4 %}d-none{% endif %}">
                                    <div class="vol-ticket vol-local">
                                        <div class="vol-header">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h5 class="text-primary mb-0">
                                                    <i class="mdi mdi-airplane-takeoff"></i> 
                                                    {{ vol.aeroportDepart }} → {{ vol.aeroportArrivee }}
                                                </h5>
                                                <span class="badge badge-flight bg-gradient-primary">#{{ vol.numVol }}</span>
                                            </div>
                                        </div>

                                        <div class="vol-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <p><i class="mdi mdi-clock-outline me-2"></i> Départ : {{ vol.dateDepart|date('d/m/Y H:i') }}</p>
                                                    <p><i class="mdi mdi-clock-check-outline me-2"></i> Arrivée : {{ vol.dateArrivee|date('d/m/Y H:i') }}</p>
                                                </div>
                                                <div class="col-md-6">
                                                    <p><i class="mdi mdi-seat-recline-extra me-2"></i> Places : {{ vol.placesDispo }}</p>
                                                    <p><i class="mdi mdi-cash-multiple me-2"></i> Prix : {{ vol.prixVol }} TND</p>
                                                </div>
                                            </div>

                                            <div class="d-flex justify-content-end mt-3">
                                                <a href="{{ path('vol_edit', {'id': vol.idVol}) }}" class="btn btn-sm btn-outline-secondary me-2">
                                                    <i class="mdi mdi-pencil"></i>
                                                </a>
                                                <form method="post" action="{{ path('vol_delete', {'id': vol.idVol}) }}" onsubmit="return confirm('Supprimer ce vol ?');">
                                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ vol.idVol) }}">
                                                    <button class="btn btn-sm btn-outline-danger">
                                                        <i class="mdi mdi-delete"></i> 
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="alert alert-info text-center">Aucun vol trouvé dans la base de données</div>
                    {% endif %}

                    <!-- Vols API -->
                    {% if apiVols is not empty %}
                 
                        <div class="row">
                            {% for flight in apiVols %}
                                <div class="col-md-6 mb-4 api-vol-item {% if loop.index > 4 %}d-none{% endif %}">
                                    <div class="vol-ticket vol-api">
                                        <div class="vol-header">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h5 class="text-info mb-0">
                                                    <i class="mdi mdi-airplane"></i>
                                                    {{ flight.departure.airport ?? 'Inconnu' }} → {{ flight.arrival.airport ?? 'Inconnu' }}
                                                </h5>
                                                <span class="badge badge-flight bg-info">{{ flight.flight.iata ?? 'N/A' }}</span>
                                            </div>
                                        </div>

                                        <div class="vol-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <p><i class="mdi mdi-clock-outline me-2"></i> Départ : {{ flight.departure.scheduled|date('d/m/Y H:i') }}</p>
                                                    <p><i class="mdi mdi-seat-recline-extra me-2"></i> Places : {{ flight.availableSeats ?? 'N/A' }}</p>
                                                </div>
                                                <div class="col-md-6">
                                                    <p><i class="mdi mdi-clock-check-outline me-2"></i> Arrivée : {{ flight.arrival.scheduled|date('d/m/Y H:i') }}</p>
                                                    <p><i class="mdi mdi-cash-multiple me-2"></i> Prix : {{ flight.price ?? 'N/A' }} TND</p>
                                                </div>
                                            </div>

                                            <div class="d-flex justify-content-end mt-3">
                                                <button class="btn btn-sm btn-outline-secondary me-2" >
                                                    <i class="mdi mdi-pencil"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger" >
                                                    <i class="mdi mdi-delete"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="alert alert-warning text-center">Aucun vol en direct trouvé via l’API.</div>
                    {% endif %}

                    {% if vols|length > 4 or apiVols|length > 4 %}
                        <div class="text-center mt-3">
                            <button id="toggleVolsBtn" class="btn btn-outline-secondary">
                                Voir plus
                            </button>
                        </div>
                    {% endif %}

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const toggleBtn = document.getElementById('toggleVolsBtn');
        const allVolItems = document.querySelectorAll('.vol-item, .api-vol-item');
        const itemsPerPage = 4;

        if (toggleBtn) {
            let isExpanded = false;
            
            const toggleVisibility = () => {
                allVolItems.forEach((item, index) => {
                    if (index >= itemsPerPage) {
                        item.classList.toggle('d-none', !isExpanded);
                    }
                });
            };

            toggleBtn.addEventListener('click', () => {
                isExpanded = !isExpanded;
                toggleVisibility();
                toggleBtn.textContent = isExpanded ? 'Voir moins' : 'Voir plus';
            });

            toggleVisibility();
        }
    });
</script>

<style>
    body {
        position: relative;
        min-height: 100vh;
        padding-bottom: 60px;
    }

    footer.footer {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 60px;
        z-index: 10;
        background: white;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}